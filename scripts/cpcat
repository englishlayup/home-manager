#!/usr/bin/env bash
set -euo pipefail

_cp() {
    if command -v xclip >/dev/null 2>&1; then
        xclip -selection clipboard
    elif command -v xsel >/dev/null 2>&1; then
        xsel --clipboard --input
    elif command -v wl-copy >/dev/null 2>&1; then
        wl-copy
    elif command -v pbcopy >/dev/null 2>&1; then
        pbcopy
    elif command -v clip.exe >/dev/null 2>&1; then
        clip.exe
    else
        echo "No clipboard utility found (xclip, xsel, wl-copy, pbcopy, clip.exe)" >&2
        return 1
    fi
}

tmpbufr=$(mktemp /tmp/smrt-cp.XXXXXX)
trap 'rm -f "$tmpbufr"' EXIT
# If arguments are given, run the command
# No args â€” read from stdin
if [ "$#" -gt 0 ]; then
    "$@" > "$tmpbufr" 2>&1
else
    cat > "$tmpbufr"
fi

# Fallback to vi if EDITOR is unset
"${EDITOR:=vi}" "$tmpbufr"
_cp < "$tmpbufr"
